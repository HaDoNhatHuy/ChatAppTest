@{
    ViewData["Title"] = "Chat";
}
@section Scripts
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.7/signalr.min.js"></script>
    <script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
    <script>
        // Truyền username từ ViewBag sang JavaScript
        const currentUser = "@ViewBag.Username";
    </script>
    <script src="~/js/chat.js"></script>
}
<div class="chat-container">
    <!-- Sidebar Left: Friends -->
    <div class="sidebar left-sidebar">
        <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Friends</h5>
            <a href="/User/Logout" class="btn btn-outline-primary btn-sm rounded-pill">Logout</a>
        </div>
        <div class="p-3">
            <div class="input-group mb-3">
                <input type="text" id="searchUser" class="form-control rounded-pill" placeholder="Search users..." />
            </div>
            <div id="searchResults" class="mb-3"></div>
            <div id="friendRequests" class="mb-3"></div>
            <ul id="friendList" class="list-unstyled mt-3"></ul>
        </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
        <div class="chat-header p-3 border-bottom d-flex align-items-center">
            <h5 class="mb-0 flex-grow-1" id="chat-intro">Select a friend to start chatting</h5>
        </div>
        <div class="messages p-3">
            <ul id="messagesList" class="list-unstyled"></ul>
        </div>
        <div class="input-area p-3 border-top d-flex align-items-center">
            <textarea id="messageInput" class="form-control rounded-pill me-2" placeholder="Type a message..." rows="1"></textarea>
            <button id="sendButton" class="btn btn-primary rounded-circle"><i class="fas fa-paper-plane"></i></button>
            <button id="startVideoCall" class="btn btn-success rounded-circle ms-2"><i class="fas fa-video"></i></button>
        </div>
        <div id="videoContainer" class="video-container d-none p-3 bg-dark">
            <div class="video-wrapper">
                <div class="remote-video-container">
                    <video id="remoteVideo" autoplay class="remote-video"></video>
                    <span id="remoteUserLabel" class="video-label"></span>
                </div>
                <div class="local-video-container">
                    <video id="localVideo" autoplay muted class="local-video"></video>
                    <span id="localUserLabel" class="video-label"></span>
                </div>
            </div>
            <div class="video-controls">
                <button id="endCallButton" class="btn btn-danger rounded-pill">Stop Call</button>
            </div>
        </div>
        <!-- Incoming Call Modal -->
        <div id="callModal" class="call-modal d-none">
            <div class="call-modal-content">
                <h5>Incoming Call from <span id="callerName"></span></h5>
                <div class="call-buttons">
                    <button id="acceptCallButton" class="btn btn-success rounded-pill">Accept</button>
                    <button id="declineCallButton" class="btn btn-danger rounded-pill">Decline</button>
                </div>
            </div>
        </div>
        <!-- Friend Request Modal -->
        <div id="friendRequestModal" class="call-modal d-none">
            <div class="call-modal-content">
                <h5>Friend Request from <span id="friendRequestSender"></span></h5>
                <div class="call-buttons">
                    <button id="acceptFriendRequestButton" class="btn btn-success rounded-pill">Accept</button>
                    <button id="declineFriendRequestButton" class="btn btn-danger rounded-pill">Decline</button>
                </div>
            </div>
        </div>
    </div>
</div>