@{
    ViewData["Title"] = "Chat";
}
@section Css{
    <link href="/css/site.css" rel="stylesheet" />
}
@section Scripts
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.7/signalr.min.js"></script>
    <script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
    <script>
        const currentUser = "@ViewBag.Username";
    </script>
    <script src="~/js/chat.js"></script>
}
<div class="chat-container">
    <!-- Sidebar Left: Friends -->
    <div class="sidebar left-sidebar">
        <div class="p-3 border-bottom">
            <h5 class="mb-0">Friends</h5>
        </div>
        <div class="p-3">
            <div class="input-group mb-3">
                <input type="text" id="searchUser" class="form-control rounded-pill" placeholder="Search users..." />
            </div>
            <div id="searchResults" class="mb-3"></div>
            <div id="friendRequests" class="mb-3"></div>
            <ul id="friendList" class="list-unstyled mt-3"></ul>
        </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
        <div class="chat-header p-3 border-bottom d-flex align-items-center">
            <h5 class="mb-0 flex-grow-1" id="chat-intro">Select a friend to start chatting</h5>
            <button id="startVideoCall" class="btn btn-success rounded-circle ms-2"><i class="fas fa-video"></i></button>
        </div>
        <div class="messages p-3 position-relative">
            <div id="typingIndicator" class="typing-indicator" style="display: none;">Typing...</div>
            <ul id="messagesList" class="messages-list">
                <div id="loadingSpinner" class="loading-spinner" style="display: none;"></div>
            </ul>
            <button id="scrollToBottomBtn" class="btn btn-sm btn-primary scroll-to-bottom" style="display: none;">↓</button>
        </div>
        <div class="input-area p-3 border-top d-flex align-items-center">
            <button id="emojiButton" class="btn btn-outline-secondary rounded-circle me-2"><i class="fas fa-smile"></i></button>
            <div class="emoji-picker" id="emojiPicker" style="display: none;">
                <span class="emoji" data-emoji="😊">😊</span>
                <span class="emoji" data-emoji="😂">😂</span>
                <span class="emoji" data-emoji="❤️">❤️</span>
                <span class="emoji" data-emoji="👍">👍</span>
                <span class="emoji" data-emoji="😢">😢</span>
                <span class="emoji" data-emoji="😡">😡</span>
                <span class="emoji" data-emoji="🎉">🎉</span>
                <span class="emoji" data-emoji="🚀">🚀</span>
            </div>
            <input type="file" id="fileInput" class="d-none" accept="image/*,.pdf,.doc,.docx" />
            <button id="fileButton" class="btn btn-outline-secondary rounded-circle me-2"><i class="fas fa-paperclip"></i></button>
            <textarea id="messageInput" class="form-control rounded-pill me-2" placeholder="Type a message..." rows="1"></textarea>
            <button id="sendButton" class="btn btn-primary rounded-circle"><i class="fas fa-paper-plane"></i></button>
        </div>
        <!-- Video Container and Modals -->
        <div id="videoContainer" class="video-container d-none p-3 bg-dark">
            <div class="video-wrapper">
                <div class="remote-video-container">
                    <video id="remoteVideo" autoplay class="remote-video"></video>
                    <span id="remoteUserLabel" class="video-label"></span>
                </div>
                <div class="local-video-container">
                    <video id="localVideo" autoplay muted class="local-video"></video>
                    <span id="localUserLabel" class="video-label"></span>
                </div>
            </div>
            <div class="video-controls">
                <button id="endCallButton" class="btn btn-danger rounded-pill">End Call</button>
            </div>
        </div>
        <!-- Incoming Call Modal -->
        <div id="callModal" class="call-modal d-none">
            <div class="call-modal-content">
                <h5>Incoming call from <span id="callerName"></span></h5>
                <div class="call-buttons">
                    <button id="acceptCallButton" class="btn btn-success rounded-pill">Accept</button>
                    <button id="declineCallButton" class="btn btn-danger rounded-pill">Decline</button>
                </div>
            </div>
        </div>
        <!-- Friend Request Modal -->
        <div id="friendRequestModal" class="call-modal d-none">
            <div class="call-modal-content">
                <h5>Friend request from <span id="friendRequestSender"></span></h5>
                <div class="call-buttons">
                    <button id="acceptFriendRequestButton" class="btn btn-success rounded-pill">Accept</button>
                    <button id="declineFriendRequestButton" class="btn btn-danger rounded-pill">Decline</button>
                </div>
            </div>
        </div>
    </div>
</div>

